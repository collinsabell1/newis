<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>School Manager - NEWIS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bg1:#0f2027;
 --bg2:#203a43;
 --bg3:#2c5364;
 --glass:rgba(255,255,255,0.12);
 --text:white;
}
.light{
 --bg1:#f2f7ff;
 --bg2:#dbeafe;
 --bg3:#c7d2fe;
 --glass:rgba(255,255,255,0.85);
 --text:#111;
}
body{
 margin:0;
 font-family:Segoe UI;
 background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
 color:var(--text);
 display:flex;
 justify-content:center;
 padding:20px;
}
.container{
 width:720px;
 background:var(--glass);
 padding:25px;
 border-radius:20px;
 backdrop-filter:blur(15px);
}
input,select,button{
 width:100%;
 padding:10px;
 margin:6px 0;
 border:none;
 border-radius:10px;
}
button{cursor:pointer;font-weight:bold}
.btn{background:#00c6ff;color:white}
.btn-edit{background:#28a745;color:white}
.btn-danger{background:#dc3545;color:white}
.btn-clear{background:#6c757d;color:white}
.item-list{display:flex;flex-wrap:wrap;gap:6px}
.item{
 background:rgba(0,0,0,.4);
 padding:5px 10px;
 border-radius:12px;
}
.spinner{display:none;text-align:center}
.search-results{
 background:#111;
 border-radius:10px;
 max-height:150px;
 overflow:auto;
 position:absolute;
 width:85%;
 z-index:99;
}
.stats{
 background:rgba(0,0,0,.4);
 padding:10px;
 border-radius:10px;
 margin-top:15px;
}
.back-btn{
position:fixed;
top:20px;
left:20px;
padding:12px 18px;
border:none;
border-radius:14px;
font-weight:600;
cursor:pointer;
color:white;
background:linear-gradient(45deg,#ff416c,#ff4b2b,#ff6a00);
background-size:300% 300%;
animation:gradientMove 6s ease infinite;
box-shadow:0 8px 20px rgba(0,0,0,.35);
z-index:9999;
}
@keyframes gradientMove{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}
</style>
</head>

<body>

<button class="back-btn" onclick="goBack()">‚¨Ö Back</button>

<div class="container">

<button onclick="toggleTheme()">Toggle Theme</button>

<h2>School Manager</h2>

<input list="countiesList" id="schoolCounty" placeholder="County">
<datalist id="countiesList"></datalist>

<input id="schoolRegion" placeholder="Region" readonly>

<button onclick="detectGPS()">üìç Detect County Automatically</button>

<div id="loader" class="spinner">üì° Detecting location...</div>
<div id="message"></div>

</div>

<script>

/* BACK BUTTON */
function goBack(){
if(document.referrer) history.back();
else location.href="index.html";
}

/* THEME */
function toggleTheme(){
document.body.classList.toggle("light")
}

/* REGIONS */
const regions={
"Nairobi":"Nairobi Region",
"Mombasa":"Coast",
"Kwale":"Coast",
"Kilifi":"Coast",
"Taita Taveta":"Coast",
"Lamu":"Coast",
"Tana River":"Coast",
"Garissa":"North Eastern",
"Wajir":"North Eastern",
"Mandera":"North Eastern"
};

/* COUNTIES */
const counties={
"Nairobi":[],
"Mombasa":[],
"Kwale":[],
"Kilifi":[],
"Taita Taveta":[],
"Lamu":[],
"Tana River":[],
"Garissa":[],
"Wajir":[],
"Mandera":[],
"Kisumu":[],
"Nakuru":[],
"Kiambu":[],
"Machakos":[],
"Meru":[],
"Nyeri":[],
"Kakamega":[],
"Uasin Gishu":[],
"Narok":[],
"Kajiado":[],
"Kericho":[],
"Bomet":[],
"Bungoma":[],
"Busia":[],
"Siaya":[],
"Homa Bay":[],
"Migori":[],
"Kisii":[],
"Nyamira":[],
"Embu":[],
"Kitui":[],
"Makueni":[],
"Murang'a":[],
"Kirinyaga":[],
"Nyandarua":[],
"Laikipia":[],
"Baringo":[],
"Nandi":[],
"Elgeyo-Marakwet":[],
"Trans Nzoia":[],
"West Pokot":[],
"Samburu":[],
"Turkana":[],
"Marsabit":[],
"Isiolo":[],
"Tharaka-Nithi":[]
};

/* LOAD COUNTY LIST */
Object.keys(counties).forEach(c=>{
countiesList.appendChild(new Option(c,c))
});

/* GPS DETECTOR (REAL VERSION) */
async function detectGPS(){

loader.style.display="block";
message.innerText="Requesting GPS permission...";

if(!navigator.geolocation){
alert("GPS not supported");
return;
}

navigator.geolocation.getCurrentPosition(async pos=>{

try{
const lat=pos.coords.latitude;
const lon=pos.coords.longitude;

message.innerText="Detecting county from satellite...";

/* REVERSE GEOCODE */
const res=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
const data=await res.json();

let county=
data.address.county ||
data.address.state_district ||
data.address.state ||
"";

county=county.replace(" County","").trim();

/* FILL FIELD */
schoolCounty.value=county;
schoolRegion.value=regions[county] || "Other Region";

message.innerText="‚úî Location detected: "+county;

}catch(err){
alert("Location detection failed");
}

loader.style.display="none";

},
()=>{
loader.style.display="none";
alert("Permission denied or GPS off");
},
{enableHighAccuracy:true,timeout:15000}
);

}

</script>
</body>
</html>
