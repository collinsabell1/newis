<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEWIS | National Analytics Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

body{
  margin:0;
  font-family:'Inter','Segoe UI',Arial,sans-serif;
  background:
    radial-gradient(circle at top left,#1b3c55,#0f2027 40%),
    radial-gradient(circle at bottom right,#203a43,#000 60%);
  color:white;
}

header{
  padding:26px 20px 30px;
  text-align:center;
  font-size:1.8em;
  font-weight:700;
}
header div{margin-top:6px}

.container{max-width:1650px;margin:auto;padding:20px}

.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
  margin-bottom:45px;
}
.kpi{
  background:rgba(255,255,255,.10);
  backdrop-filter:blur(18px);
  border-radius:22px;
  padding:22px;
}
.progress{
  height:14px;
  background:rgba(255,255,255,.18);
  border-radius:12px;
  overflow:hidden;
}
.progress div{
  height:100%;
  background:linear-gradient(90deg,#00c6ff,#00ffcc);
}
.kpi p{margin-top:14px}

.actions,.charts,.status-cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
  margin-bottom:45px;
}
.action-card,.status{
  background:rgba(255,255,255,.10);
  backdrop-filter:blur(18px);
  border-radius:22px;
  padding:26px;
}
.chart-card{
  background:white;
  color:black;
  border-radius:22px;
  padding:22px;
  height:390px;
}

.button-bar{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-bottom:45px;
}
.button-bar button{
  padding:14px 26px;
  border-radius:30px;
  border:none;
  background:linear-gradient(135deg,#00c6ff,#00ffcc);
  font-weight:700;
}
.section-title{font-size:1.4em;font-weight:700;margin:55px 0 18px}
.note{text-align:center;opacity:.85}
</style>
</head>

<body>

<header>
ðŸ“Š NEWIS â€“ National Education Risk Intelligence
<div style="font-size:.7em;opacity:.8">
AI-Powered Completion, Dropout & Intervention Command Center
</div>
</header>

<div class="container">

<div class="kpis">
  <div class="kpi"><h3>Total Students</h3><div class="progress"><div id="tBar"></div></div><p id="tTxt"></p></div>
  <div class="kpi"><h3>Likely Completion</h3><div class="progress"><div id="cBar"></div></div><p id="cTxt"></p></div>
  <div class="kpi"><h3>High Dropout Risk</h3><div class="progress"><div id="dBar"></div></div><p id="dTxt"></p></div>
  <div class="kpi"><h3>Missing Data</h3><div class="progress"><div id="mBar"></div></div><p id="mTxt"></p></div>
</div>

<div class="charts">
  <div class="chart-card"><canvas id="riskChart"></canvas></div>
  <div class="chart-card"><canvas id="sourceChart"></canvas></div>
  <div class="chart-card"><canvas id="completionChart"></canvas></div>
  <div class="chart-card"><canvas id="trendChart"></canvas></div>
</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
"https://xnvnskxcsphbvkxhndui.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhudm5za3hjc3BoYnZreGhuZHVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MjEwNjIsImV4cCI6MjA4Njk5NzA2Mn0.QMn4OHjv9CQC3RIj62aJG8JXI03gtbodtUEIP7uhwLQ"
);

let total=0, complete=0, dropout=0, missing=0;
let risk={Low:0,Medium:0,High:0};

async function loadData(){

const { data: students, error } = await supabase
.from("students")
.select("*");

if(error){
console.error(error);
alert("Database error");
return;
}

for(const s of students){
total++;

const { data: acad } = await supabase
.from("academics")
.select("average")
.eq("student_id",s.id)
.single();

const { data: beh } = await supabase
.from("behavioral")
.select("riskPercent")
.eq("student_id",s.id)
.single();

const { data: ass } = await supabase
.from("assessment")
.select("riskPercent")
.eq("student_id",s.id)
.single();

if(!acad||!beh||!ass){
missing++;
continue;
}

let avg=Number(acad.average)||0;

let riskScore=
(100-avg)*0.4+
(beh.riskPercent||0)*0.3+
(ass.riskPercent||0)*0.3;

if(riskScore>=65){
dropout++;
risk.High++;
}
else if(riskScore>=40){
complete++;
risk.Medium++;
}
else{
complete++;
risk.Low++;
}
}

render();
}

function render(){

const pct=v=>total?Math.round(v/total*100):0;

tBar.style.width="100%";
tTxt.textContent=total+" learners";

cBar.style.width=pct(complete)+"%";
cTxt.textContent=complete+" expected to complete";

dBar.style.width=pct(dropout)+"%";
dTxt.textContent=dropout+" high risk";

mBar.style.width=pct(missing)+"%";
mTxt.textContent=missing+" incomplete";

new Chart(riskChart,{
type:"doughnut",
data:{labels:["Low","Medium","High"],
datasets:[{data:[risk.Low,risk.Medium,risk.High]}]}
});

new Chart(completionChart,{
type:"pie",
data:{labels:["Completion","Dropout"],
datasets:[{data:[complete,dropout]}]}
});

new Chart(sourceChart,{
type:"bar",
data:{labels:["Complete","Missing"],
datasets:[{data:[total-missing,missing]}]}
});

new Chart(trendChart,{
type:"line",
data:{
labels:["2021","2022","2023","2024","2025"],
datasets:[{data:[60,52,46,39,34],tension:.4}]
}
});
}

loadData();
</script>

</body>
</html>
