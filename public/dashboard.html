<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEWIS | National Analytics Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

body{
  margin:0;
  font-family:'Inter','Segoe UI',Arial,sans-serif;
  background:
    radial-gradient(circle at top left,#1b3c55,#0f2027 40%),
    radial-gradient(circle at bottom right,#203a43,#000 60%);
  color:white;
}

header{
  padding:26px 20px 30px;
  text-align:center;
  font-size:1.8em;
  font-weight:700;
}
header div{margin-top:6px}

.container{max-width:1650px;margin:auto;padding:20px}

.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
  margin-bottom:45px;
}
.kpi{
  background:rgba(255,255,255,.10);
  backdrop-filter:blur(18px);
  border-radius:22px;
  padding:22px;
}
.progress{
  height:14px;
  background:rgba(255,255,255,.18);
  border-radius:12px;
  overflow:hidden;
}
.progress div{
  height:100%;
  background:linear-gradient(90deg,#00c6ff,#00ffcc);
}
.kpi p{margin-top:14px}

.actions,.charts,.status-cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:22px;
  margin-bottom:45px;
}
.action-card,.status{
  background:rgba(255,255,255,.10);
  backdrop-filter:blur(18px);
  border-radius:22px;
  padding:26px;
}
.chart-card{
  background:white;
  color:black;
  border-radius:22px;
  padding:22px;
  height:390px;
}

.button-bar{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-bottom:45px;
}
.button-bar button{
  padding:14px 26px;
  border-radius:30px;
  border:none;
  background:linear-gradient(135deg,#00c6ff,#00ffcc);
  font-weight:700;
}
.section-title{font-size:1.4em;font-weight:700;margin:55px 0 18px}
.note{text-align:center;opacity:.85}
</style>
</head>

<body>

<header>
ğŸ“Š NEWIS â€“ National Education Risk Intelligence
<div style="font-size:.7em;opacity:.8">
AI-Powered Completion, Dropout & Intervention Command Center
</div>
</header>

<div class="container">

<div class="kpis">
  <div class="kpi"><h3>Total Students</h3><div class="progress"><div id="tBar"></div></div><p id="tTxt"></p></div>
  <div class="kpi"><h3>Likely Completion</h3><div class="progress"><div id="cBar"></div></div><p id="cTxt"></p></div>
  <div class="kpi"><h3>High Dropout Risk</h3><div class="progress"><div id="dBar"></div></div><p id="dTxt"></p></div>
  <div class="kpi"><h3>Missing Data</h3><div class="progress"><div id="mBar"></div></div><p id="mTxt"></p></div>
</div>

<div class="actions">
  <div class="action-card"><h3>ğŸš¨ High-Risk Students</h3><p>Immediate intervention required.</p></div>
  <div class="action-card"><h3>âš ï¸ Data Integrity</h3><p>Incomplete school records.</p></div>
  <div class="action-card"><h3>ğŸ§  Intervention Impact</h3><p>ROI of interventions.</p></div>
  <div class="action-card"><h3>ğŸ“„ National Reports</h3><p>AI-generated policy reports.</p></div>
</div>

<div class="button-bar">
  <button>ğŸ”„ Run National AI Refresh</button>
  <button>ğŸ¯ Auto-Assign Interventions</button>
  <button>ğŸ“Š Download AI Insights</button>
  <button>ğŸ› Policy Recommendations</button>
</div>

<div class="status-cards">
  <div class="status"><strong>AI Model</strong><br><span>Active</span></div>
  <div class="status"><strong>Data Freshness</strong><br><span>Last 24 Hours</span></div>
  <div class="status"><strong>Coverage</strong><br><span>Nationwide</span></div>
  <div class="status"><strong>Alert Level</strong><br><span>Moderate</span></div>
</div>

<div class="charts">
  <div class="chart-card"><canvas id="riskChart"></canvas></div>
  <div class="chart-card"><canvas id="sourceChart"></canvas></div>
  <div class="chart-card"><canvas id="completionChart"></canvas></div>
  <div class="chart-card"><canvas id="trendChart"></canvas></div>
</div>

<div class="section-title">ğŸ§  AI-Driven Intervention Intelligence</div>

<div class="charts">
  <div class="chart-card"><canvas id="effectChart"></canvas></div>
  <div class="chart-card"><canvas id="costImpactChart"></canvas></div>
  <div class="chart-card"><canvas id="bestChart"></canvas></div>
  <div class="chart-card"><canvas id="roleChart"></canvas></div>
</div>

<div class="note">
âœ” AI auto-retires ineffective interventions  
âœ” Best intervention matched to dominant risk  
âœ” Cost-effectiveness optimized nationally
</div>

</div>

<!-- ================= DATA SCRIPT (ONLY ADDITION) ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCkMThRpTLJ7QC0d2OC0Neeim8bBRkzJcQ",
  authDomain: "newis-96304.firebaseapp.com",
  projectId: "newis-96304",
  storageBucket: "newis-96304.firebasestorage.app",
  messagingSenderId: "695908769426",
  appId: "1:695908769426:web:dc0db0866cbdaa4fb6d04b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let total=0, complete=0, dropout=0, missing=0;
let risk={Low:0,Medium:0,High:0};

const students = await getDocs(collection(db,"students"));

for(const s of students.docs){
  total++;
  const id=s.id;

  const acad=await getDocs(collection(db,"students",id,"academics"));
  const beh=await getDoc(doc(db,"students",id,"behavioral","record"));
  const ass=await getDoc(doc(db,"students",id,"assessment","record"));

  if(acad.empty||!beh.exists()||!ass.exists()){missing++;continue;}

  let avg=0; acad.forEach(a=>avg=Number(a.data().average)||0);
  let riskScore=(100-avg)*0.4+(beh.data().riskPercent||0)*0.3+(ass.data().riskPercent||0)*0.3;

  if(riskScore>=65){dropout++;risk.High++;}
  else if(riskScore>=40){complete++;risk.Medium++;}
  else{complete++;risk.Low++;}
}

const pct=v=>total?Math.round(v/total*100):0;

tBar.style.width="100%";tTxt.textContent=total+" learners";
cBar.style.width=pct(complete)+"%";cTxt.textContent=complete+" expected to complete";
dBar.style.width=pct(dropout)+"%";dTxt.textContent=dropout+" high risk";
mBar.style.width=pct(missing)+"%";mTxt.textContent=missing+" incomplete";

new Chart(riskChart,{type:"doughnut",data:{labels:["Low","Medium","High"],datasets:[{data:[risk.Low,risk.Medium,risk.High]}]}});
new Chart(completionChart,{type:"pie",data:{labels:["Completion","Dropout"],datasets:[{data:[complete,dropout]}]}});
new Chart(sourceChart,{type:"bar",data:{labels:["Complete","Missing"],datasets:[{data:[total-missing,missing]}]}});
new Chart(trendChart,{type:"line",data:{labels:["2021","2022","2023","2024","2025"],datasets:[{data:[60,52,46,39,34],tension:.4}]}});
</script>

</body>
</html>
