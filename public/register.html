<!DOCTYPE html>
<html>
<head>
  <title>School Registration</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body{
      font-family: Arial;
      background:#f4f6f9;
      padding:40px;
    }
    .box{
      background:white;
      padding:25px;
      border-radius:10px;
      width:420px;
      margin:auto;
      box-shadow:0 0 10px rgba(0,0,0,0.15);
    }
    input,select,button{
      width:100%;
      padding:10px;
      margin-top:10px;
      border-radius:6px;
      border:1px solid #ccc;
    }
    button{
      background:#007bff;
      color:white;
      border:none;
      cursor:pointer;
      font-weight:bold;
    }
    button:hover{
      background:#0056b3;
    }
  </style>
</head>
<body>

<div class="box">
<h2>Register School</h2>

<form id="schoolForm">

<input type="text" id="name" placeholder="School Name" required>

<input type="text" id="code" placeholder="School Code" required>

<select id="county" required>
<option value="">Select County</option>
<option>Nairobi</option>
<option>Mombasa</option>
<option>Kisumu</option>
<option>Nakuru</option>
<option>Kiambu</option>
</select>

<input type="text" id="subcounty" placeholder="Sub County" required>

<input type="date" id="dob" required>

<input type="number" id="age" placeholder="Age auto calculated" readonly>

<button type="submit">Register School</button>

</form>
</div>

<script>
/* SUPABASE CONNECTION */
const supabase = window.supabase.createClient(
  "https://xnvnskxcsphbvkxhndui.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhudm5za3hjc3BoYnZreGhuZHVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MjEwNjIsImV4cCI6MjA4Njk5NzA2Mn0.QMn4OHjv9CQC3RIj62aJG8JXI03gtbodtUEIP7uhwLQ"
);

/* AGE AUTO CALCULATE */
document.getElementById("dob").addEventListener("change", function(){
  const dob = new Date(this.value);
  const today = new Date();

  let age = today.getFullYear() - dob.getFullYear();
  const m = today.getMonth() - dob.getMonth();

  if(m < 0 || (m === 0 && today.getDate() < dob.getDate())){
    age--;
  }

  document.getElementById("age").value = age;
});


/* FORM SUBMIT */
document.getElementById("schoolForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  const data = {
    name: document.getElementById("name").value,
    code: document.getElementById("code").value,
    county: document.getElementById("county").value,
    subcounty: document.getElementById("subcounty").value,
    dob: document.getElementById("dob").value,
    age: document.getElementById("age").value
  };

  console.log("Submitting:", data);

  const { error } = await supabase
    .from("schools")
    .insert([data]);

  if(error){
    alert("Error: " + error.message);
    console.error(error);
  } else {
    alert("School registered successfully!");
    document.getElementById("schoolForm").reset();
    document.getElementById("age").value="";
  }
});
</script>

</body>
</html>
